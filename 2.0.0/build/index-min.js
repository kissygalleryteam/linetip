KISSY.add("kg/linetip/2.0.0/index",["base","node"],function(t,i,e,s){var n,a=i("base"),r=i("node");n=function(i){return function(e){var s=r.all,n=a,o="http://www.w3.org/2000/svg",l={delayLine:function(t,i){var e=arguments.callee,s=i.shift();t.shift()(),t.length&&setTimeout(function(){e(t,i)},1e3*s)}},h={cssCircle:function(t,i){var e=Math.PI*i*2;s(t).css({"stroke-dasharray":e+","+e,"stroke-dashoffset":0})},cssPolyline:function(t,i){var e=i[0],n=i[1],a=i[2],r=Math.sqrt((e[0]-n[0])*(e[0]-n[0])+(e[1]-n[1])*(e[1]-n[1])),o=Math.sqrt((a[0]-n[0])*(a[0]-n[0])+(a[1]-n[1])*(a[1]-n[1])),l=r+o;s(t).css({"stroke-dasharray":l+","+l,"stroke-dashoffset":0})},cssStrCommon:function(t,i){var e=t+"{";for(var s in i)e+=s+":"+i[s]+";";return e+="}"},cssStrAnimation:function(t,i,e){return" @-webkit-keyframes "+t+" {"+this.cssStrCommon("from",i)+this.cssStrCommon("to",e)+"}"}},c={$:function(t){return s[0]},create:function(t,i){var n=e.createElementNS(o,t);return"svg"===t&&(i.xmlns=o),s(n).attr(i),n},getHorizontalDir:function(t){var i=t.length;return t[0][0]<t[i-1][0]?"left2right":"right2left"},getLongitudinalDir:function(t){var i=t.length;return t[0][1]<t[i-1][1]?"top2bottom":"bottom2top"},getLineLength:function(t){for(var i=0,e=0,s=t.length;s>e;e++){var n=t[e],a=t[e+1];a&&(i+=Math.sqrt((a[0]-n[0])*(a[0]-n[0])+(a[1]-n[1])*(a[1]-n[1])))}return i}},p=function(i){var e={color:"#000",size:2,radius:4,opacity:.5,animateTime:1,animateType:"linear"};i||(i={}),this.pointsOps=t.merge(e,i.points),this.lineOps=t.merge(e,i.line)};t.extend(p,n,{addDefault:function(t){for(var i in t)t[i]||t[i]===!1||(t[i]=this.defaultOptions[i]);return t},countSVGWH:function(t){for(var i=t.points,e=t.html,s=[0,0],n=0,a=e.width||0,r=e.height||0,o=0,l=i.length;l>o;o++)Math.abs(i[o][0])>Math.abs(s[0])&&(s[0]=i[o][0]),Math.abs(i[o][1])>Math.abs(s[1])&&(s[1]=i[o][1]);return"right2left"==c.getHorizontalDir(i)&&(a=0),n="top2bottom"==c.getLongitudinalDir(i)?Math.max(Math.abs(s[1]),r):Math.min(Math.abs(s[1]),r),{width:Math.abs(s[0])+a,height:n}},formatePoints:function(t){for(var i=t.html,e=t.points,s=0,n=0,a="",r=0,o=e.length;o>r;r++){var l=e[r];l[0]<0&&Math.abs(l[0])>Math.abs(s)&&(s=l[0]),l[1]<0&&Math.abs(l[1])>Math.abs(n)&&(n=l[1])}for(r=0;o>r;r++)e[r][0]+=-1*s,e[r][1]+=-1*n;for(r=0;o>r;r++)"right2left"==c.getHorizontalDir(e)&&(e[r][0]+=i.width),a+=e[r].join(" ")+",";return a=a.substr(0,a.length-1),{arr:e,str:a}},fixCxCy:function(t,i,e){var s=t/2+e,n=t/2,a=t/2+e,r=i[0],o=i[1],l=i[i.length-1],h=i[i.length-2],c=o[0]>r[0]?-1:1,p=h[0]>l[0]?-1:1,f=h[1]>l[1]?-1:1;return{head:[r[0]+c*s,r[1]],tail:[l[0]+p*n,l[1]+f*a]}},getValues:function(t,i){var e=this.fixCxCy(this.pointsOps.radius,t.arr,this.pointsOps.size);return{polyline:{"class":"polyline",fill:"none",stroke:this.lineOps.color,"stroke-width":this.lineOps.size,"stroke-opacity":this.lineOps.opacity,points:t.str},headCircle:{"class":"head-circle",fill:"none",cx:e.head[0],cy:e.head[1],r:this.pointsOps.radius,stroke:this.pointsOps.color,"stroke-width":this.pointsOps.size,"stroke-opacity":this.pointsOps.opacity},tailCircle:{"class":"tail-circle",fill:"none",cx:e.tail[0],cy:e.tail[1],r:this.pointsOps.radius,stroke:this.pointsOps.color,"stroke-width":this.pointsOps.size,"stroke-opacity":this.pointsOps.opacity},foreignObject:{x:"right2left"==c.getHorizontalDir(t.arr)?e.tail[0]-i.html.width:e.tail[0],y:e.tail[1],width:i.html.width||0,height:i.html.height||0}}},getRotate:function(t){var i,e,s=(t[0],t[1]),n=t[2],a=Math.atan((n[1]-s[1])/(n[0]-s[0])),r=180*a/Math.PI;return"left2right"==c.getHorizontalDir(t)?(i=r>=0?-1:1,e=i*(180-Math.abs(r))):(i=r>=0?1:-1,e=i*Math.abs(r)),e},add:function(t){var i=this.formatePoints(t),s=this.countSVGWH(t),n=this.getValues(i,t),a=c.create("svg",s),r=c.create("polyline",n.polyline),o=c.create("circle",n.headCircle),p=c.create("circle",n.tailCircle),f=c.create("foreignObject",n.foreignObject);if(h.cssCircle(o,this.pointsOps.radius),h.cssPolyline(r,i.arr),h.cssCircle(p,this.pointsOps.radius),p.style.webkitTransform="rotate("+this.getRotate(i.arr)+"deg)",cssStyle=h.cssStrCommon("svg",{padding:"10px"}),cssStyle+=h.cssStrCommon(".head-circle",{"-webkit-animation":"dash_circle "+this.pointsOps.animateTime+"s "+this.pointsOps.animateType+" 1 alternate"}),cssStyle+=h.cssStrCommon(".tail-circle",{"-webkit-transform-origin":"50% 50%","-webkit-animation":"dash_circle "+this.pointsOps.animateTime+"s "+this.pointsOps.animateType+" 1 alternate"}),cssStyle+=h.cssStrCommon(".polyline",{"-webkit-animation":"dash "+this.lineOps.animateTime+"s "+this.lineOps.animateType+" 1 alternate"}),cssStyle+=h.cssStrAnimation("dash_circle",{"stroke-dashoffset":2*this.pointsOps.radius*Math.PI},{"stroke-dashoffset":0}),cssStyle+=h.cssStrAnimation("dash",{"stroke-dashoffset":c.getLineLength(i.arr)},{"stroke-dashoffset":0}),!c.$("lineChartStyle")){var d=e.createElement("style");d.id="lineChartStyle",d.innerHTML=cssStyle,e.getElementsByTagName("head")[0].appendChild(d)}f.innerHTML=t.html.tpl(),l.delayLine([function(){a.appendChild(o)},function(){a.appendChild(r)},function(){a.appendChild(p)},function(){a.appendChild(f)}],[this.pointsOps.animateTime,this.lineOps.animateTime,this.pointsOps.animateTime]),e.getElementsByTagName("body")[0].appendChild(a)}},{ATTRS:{$target:{value:"",getter:function(t){return s(t)}}}}),i=p}(document),i}(),s.exports=n});